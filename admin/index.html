<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>NK3IO - Panel</title>
    <link rel="stylesheet" href="/admin/style.css">
</head>
<body>
    <header>
        <h1>Panel NK3IO</h1>
        <button id="logoutBtn">Salir</button>
    </header>
    <main>
        <div class="url-form">
            <input type="url" id="longUrl" placeholder="https://ejemplo.com">
            <button id="shortenBtn">Acortar</button>
        </div>
        <div class="url-list">
            <table>
                <thead>
                    <tr>
                        <th>URL Corta</th>
                        <th>URL Original</th>
                        <th>Clicks</th>
                    </tr>
                </thead>
                <tbody id="urlTableBody"></tbody>
            </table>
        </div>
    </main>
    <script>
        // Mostrar todas las URLs al cargar
        async function loadUrls() {
            const response = await fetch('/.netlify/functions/urls');
            const urls = await response.json();
            const tableBody = document.getElementById('urlTableBody');
            
            tableBody.innerHTML = urls.map(url => `
                <tr>
                    <td><a href="/${url.short_code}" target="_blank">${url.short_code}</a></td>
                    <td>${url.original_url}</td>
                    <td>${url.clicks}</td>
                </tr>
            `).join('');
        }

        // Acortar nueva URL
        document.getElementById('shortenBtn').onclick = async () => {
            const longUrl = document.getElementById('longUrl').value;
            const response = await fetch(`/.netlify/functions/urls?url=${encodeURIComponent(longUrl)}`);
            const data = await response.json();
            alert(`URL acortada: ${data.shortUrl}`);
            loadUrls();
        };

        // Cerrar sesión
        document.getElementById('logoutBtn').onclick = () => {
            if (confirm("¿Salir del panel?")) {
                window.location.href = "/";
            }
        };

        loadUrls();
    </script>
</body>
</html>
